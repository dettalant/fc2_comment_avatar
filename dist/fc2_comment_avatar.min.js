/*!
 * @file fc2_comment_avatar.js
 * See {@link https://github.com/dettalant/fc2_comment_avatar| dettalant/fc2_comment_avatar}
 *
 * @author dettalant
 * @version v0.2.0
 * @license MIT License
 */
var fc2_comment_avatar=function(a){"use strict";function s(a){this.message=a,this.name="NavManagerError"}s.prototype.toString=function(){return this.name+": "+this.message};function t(a){if(this.isUseDataSrc=!1,this.isUseCustomDefaultImg=!1,this.isUseAdminAvatar=!0,void 0===a)throw new s("初期化に必要な情報が入力されませんでした。CommentAvatarクラスの初期化引数には必要情報が格納されたobjectを入れてください");var t=document.getElementsByClassName(a.avatarClassName);if(0===t.length)throw new s("アバター要素の取得に失敗しました");var e=document.getElementById(a.avatarSelectButtonId);if(null===e)throw new s("アバター選択ボタン要素の取得に失敗しました");this.avatarContainers=t,this.avatarClassName=a.avatarClassName,this.avatarImgClassName=a.avatarImgClassName,this.avatarsList=this.avatarsListFormat(a.avatarsList),this.avatarSelectButton=e,this.avatarSelectButtonId=a.avatarSelectButtonId,a.isUseDataSrc&&(this.isUseDataSrc=a.isUseDataSrc),!1===a.isUseAdminAvatar&&(this.isUseAdminAvatar=a.isUseAdminAvatar),this.avatarSelectButtonImg=this.avatarSelectButtonInit(this.avatarSelectButton);var r=this.scanAvatarCodes();this.avatarsImgOverWrite(r)}return t.prototype.avatarsListFormat=function(a){var t="__default__";return void 0===a[t]?a[t]="https://static.fc2.com/image/sh_design/no_image/no_image_300x300.png":this.isUseCustomDefaultImg=!0,void 0===a.__admin__&&(this.isUseAdminAvatar=!1),a},t.prototype.avatarSelectButtonInit=function(a){var t=[],e=document.createElement("img");e.className="comment_avatar_img lazyload";var r=this.genDefaultAvatarData();r.imgEl=e,this.avatarImgOverWrite(r);var s=document.createElement("div");s.className="comment_form_avatar_img_wrapper",s.appendChild(e),t.push(s);var i=a.dataset.buttonText;if(void 0!==i){var n=document.createElement("span");n.className="comment_form_avatar_button_text",n.innerText=i,t.push(n)}var v=document.createElement("div");return v.className="comment_form_avatar_select_container",t.push(v),function(a,t){for(var e=t.length,r=0;r<e;r++)a.appendChild(t[r])}(a,t),e},t.prototype.avatarDataOverWrite=function(a,t,e,r){return t instanceof HTMLImageElement&&(a.imgEl=t),void 0!==e&&(a.name=e),void 0!==r&&(a.url=r),a},t.prototype.scanAvatarCodes=function(){for(var a=this.avatarContainers.length,t=[],e=0;e<a;e++){var r=this.avatarContainers[e],s=r.dataset.avatarCode,i=r.dataset.isAdminAvatar;if(this.isUseAdminAvatar&&i){var n="__admin__",v=this.avatarDataOverWrite(this.genDefaultAvatarData(),r.querySelector("."+this.avatarImgClassName),n,this.avatarsList[n]);t.push(v)}else if(void 0===s||-1===s.indexOf("[[")&&-1===s.indexOf("]]")){if(this.isUseCustomDefaultImg){var m=this.avatarDataOverWrite(this.genDefaultAvatarData(),r.querySelector("."+this.avatarImgClassName));t.push(m)}}else{var o=/\[\[[\s　]*?([^\[\]\s　]+?)[\s　]*?\]\]/.exec(s);if(null!==o){var l=o[1];if(this.isMatchAvatarName(l)){var u=this.avatarDataOverWrite(this.genDefaultAvatarData(),r.querySelector("."+this.avatarImgClassName),l,this.avatarsList[l]);t.push(u)}}}}return t},t.prototype.isMatchAvatarName=function(a){return!!this.avatarsList[a]},t.prototype.genDefaultAvatarData=function(){var a="__default__";return{imgEl:null,name:a,url:this.avatarsList[a]}},t.prototype.avatarImgOverWrite=function(a){null!==a.imgEl&&(this.isUseDataSrc?a.imgEl.dataset.src=a.url:a.imgEl.src=a.url)},t.prototype.avatarsImgOverWrite=function(a){for(var t=a.length,e=0;e<t;e++)this.avatarImgOverWrite(a[e])},a.CommentAvatar=t,a}({});
