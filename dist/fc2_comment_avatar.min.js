/*!
 * @file fc2_comment_avatar.js
 * See {@link https://github.com/dettalant/fc2_comment_avatar| dettalant/fc2_comment_avatar}
 *
 * @author dettalant
 * @version v0.2.0
 * @license MIT License
 */
var fc2_comment_avatar=function(a){"use strict";function s(a){this.message=a,this.name="NavManagerError"}s.prototype.toString=function(){return this.name+": "+this.message};function t(a){if(this.isUseDataSrc=!1,void 0===a)throw new s("初期化に必要な情報が入力されませんでした。CommentAvatarクラスの初期化引数には必要情報が格納されたobjectを入れてください");var t=document.getElementsByClassName(a.avatarClassName);if(0===t.length)throw new s("アバター要素の取得に失敗しました");var e=document.getElementById(a.avatarSelectButtonId);if(null===e)throw new s("アバター選択ボタン要素の取得に失敗しました");this.avatarContainers=t,this.avatarClassName=a.avatarClassName,this.avatarImgClassName=a.avatarImgClassName,this.avatarsList=a.avatarsList,this.avatarSelectButton=e,this.avatarSelectButtonId=a.avatarSelectButtonId,a.isUseDataSrc&&(this.isUseDataSrc=a.isUseDataSrc),this.avatarSelectButtonImg=this.avatarSelectButtonInit(this.avatarSelectButton);var r=this.scanAvatarCodes();this.avatarsImgOverWrite(r)}return t.prototype.avatarSelectButtonInit=function(a){var t=document.createElement("img");t.className="comment_avatar_img lazyload";var e=this.genDefaultAvatarData();e.imgEl=t,this.avatarImgOverWrite(e);var r=document.createElement("div");r.className="comment_form_avatar_img_wrapper",r.appendChild(t),a.appendChild(r);var s=a.dataset.buttonText;if(void 0!==s){var i=document.createElement("span");i.className="comment_form_avatar_button_text",i.innerText=s,a.appendChild(i)}return t},t.prototype.scanAvatarCodes=function(){for(var a=this.avatarContainers.length,t=[],e=0;e<a;e++){var r=this.avatarContainers[e],s=r.dataset.avatarCode;if(void 0!==s&&(-1!==s.indexOf("[[")||-1!==s.indexOf("]]"))){var i=/\[\[[\s　]*?([^\[\]\s　]+?)[\s　]*?\]\]/.exec(s);if(null!==i){var n=i[1];if(this.isMatchAvatarName(n)){var o=this.genDefaultAvatarData();o.imgEl=r.querySelector("."+this.avatarImgClassName),o.name=n,o.url=this.avatarsList[n],t.push(o)}}}}return t},t.prototype.isMatchAvatarName=function(a){return!!this.avatarsList[a]},t.prototype.genDefaultAvatarData=function(){var a="__default__",t="//static.fc2.com/image/sh_design/no_image/no_image_300x300.png";return this.avatarsList[a]&&(t=this.avatarsList[a]),{imgEl:null,name:a,url:t}},t.prototype.avatarImgOverWrite=function(a){null!==a.imgEl&&(this.isUseDataSrc?a.imgEl.dataset.src=a.url:a.imgEl.src=a.url)},t.prototype.avatarsImgOverWrite=function(a){for(var t=a.length,e=0;e<t;e++)this.avatarImgOverWrite(a[e])},a.CommentAvatar=t,a}({});
